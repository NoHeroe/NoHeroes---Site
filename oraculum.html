<!doctype html>

<html lang="pt-br" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Oráculo — NoHeroes</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fontes (mesmas vibes do Manual das Sombras) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        container: { center: true, padding: { DEFAULT: '1rem', md: '1.5rem' } },
        extend: {
          colors: { nhBg: '#0b0b0e', nhInk: '#e6e3df', nhInkDim: '#b4b0aa' },
          borderRadius: { '2xl': '1.25rem' },
          boxShadow: { glow: '0 0 40px rgba(155,93,229,.18)' }
        }
      }
    }
  </script>
  <style>
    :root{ --nh-bg:#0b0b0e; --nh-ink:#e6e3df; --nh-ink-dim:#b4b0aa; --nh-accent:#9b5de5; --nh-gold:#ffe1a8; --nh-rose:#e36d6d }
    body{ background: var(--nh-bg); color: var(--nh-ink); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif }
    .cinzel{ font-family: Cinzel, ui-serif, Georgia, serif }
    .panel{ border:1px solid rgba(255,255,255,.07); border-radius: 1rem; background: color-mix(in lab, var(--nh-bg), black 8%); backdrop-filter: blur(6px) }
    .gradiente-noheroes{ background-image: linear-gradient(90deg,var(--nh-gold), var(--nh-rose) 40%, var(--nh-accent)); -webkit-background-clip:text; background-clip:text; color: transparent }
    /* Botão animado no estilo Manual das Sombras */
    .btn-x{ position:relative; display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.6rem 1rem; border-radius:1rem; color:var(--nh-ink); border:1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.06); overflow:hidden; transition: transform .08s ease, background .25s ease, border-color .25s ease }
    .btn-x::before{ content:""; position:absolute; inset:-2px; background: conic-gradient(from 0deg, rgba(255,225,168,.0), rgba(227,109,109,.35), rgba(155,93,229,.35), rgba(255,225,168,.0)); filter: blur(10px); transform: translateX(-120%); transition: transform .6s ease }
    .btn-x:hover{ background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.18) }
    .btn-x:hover::before{ transform: translateX(0) }
    .btn-x:active{ transform: scale(.985) }
    .chip{ font-size:.82rem; border:1px solid rgba(255,255,255,.12); border-radius:999px; padding:.35rem .7rem; background:rgba(255,255,255,.04); white-space:nowrap }
    .chip:hover{ background:rgba(255,255,255,.09) }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:rgba(255,255,255,.08); padding:.12rem .4rem; border-radius:.4rem }
    .icon{ width:1.05rem; height:1.05rem; opacity:.85 }
    @media (prefers-reduced-motion: reduce){ .btn-x{ transition:none } .btn-x::before{ display:none } }
  </style>
</head>
<body class="h-full">
  <!-- Background brasas -->
  <canvas id="brasasCanvas" class="fixed inset-0 -z-10 opacity-[0.16] pointer-events-none"></canvas>  <!-- Modal de aviso (teste IA) -->  <div id="betaModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative w-full max-w-md panel shadow-glow">
      <div class="p-5">
        <h3 class="cinzel text-xl gradiente-noheroes">Oráculo NoHeroes</h3>
        <p class="mt-2 text-[var(--nh-ink-dim)] text-sm">Este Oráculo está em <strong>fase de testes</strong> com a IA da NoHeroes em desenvolvimento. A experiência já é funcional, mas respostas podem evoluir.</p>
        <div class="mt-4 flex justify-end gap-2">
          <button id="betaOk" class="btn-x">Entendi</button>
        </div>
      </div>
    </div>
  </div>  <main class="container max-w-3xl md:max-w-4xl pt-10 pb-16">
    <!-- Topo -->
    <header class="mb-6 md:mb-8">
      <div class="flex items-center gap-3">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v3m0 12v3m9-9h-3M6 12H3m13.95 5.95-2.12-2.12M8.17 8.17 6.05 6.05m11.9 0-2.12 2.12M8.17 15.83l-2.12 2.12"/></svg>
        <h1 class="cinzel text-[1.9rem] md:text-[2.3rem] leading-tight gradiente-noheroes">Oráculo</h1>
      </div>
      <p class="text-[var(--nh-ink-dim)] mt-1 text-sm md:text-base">Pergunte sobre o universo NoHeroes. Respostas rápidas agora; IA depois.</p>
    </header><!-- Busca -->
<section class="panel p-4 md:p-5">
  <div class="flex items-center gap-2 md:gap-3">
    <svg class="icon shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="m21 21-4.3-4.3"/></svg>
    <input id="query" inputmode="search" placeholder="Digite sua dúvida (Ctrl/⌘+K)" class="flex-1 bg-transparent outline-none placeholder:text-[var(--nh-ink-dim)] text-[15px] md:text-base" />
    <button id="clearBtn" class="hidden text-sm text-[var(--nh-ink-dim)] hover:text-[var(--nh-ink)]">limpar</button>
    <button id="askBtn" class="btn-x text-sm md:text-base">Perguntar</button>
  </div>
  <div id="suggestions" class="mt-3 flex gap-2 overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none] pb-1"><style>#suggestions::-webkit-scrollbar{display:none}</style></div>
</section>

<!-- Sugeridos -->
<section id="quickResults" class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-3"></section>

<!-- Resposta -->
<section class="mt-4 md:mt-6">
  <div class="panel p-4 md:p-5">
    <div class="flex flex-wrap items-center justify-between gap-2">
      <div class="flex items-center gap-2">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        <h2 class="cinzel text-lg md:text-xl">Resposta</h2>
      </div>
      <div class="flex items-center gap-2">
        <button id="historyToggle" class="chip">Histórico</button>
        <button id="copyBtn" class="chip">Copiar</button>
      </div>
    </div>
    <div id="answerBox" class="min-h-[112px] md:min-h-[140px] mt-3 rounded-xl border border-white/10 bg-black/20 p-3 md:p-4 text-[0.96rem] md:text-[1rem]"></div>
    <div class="mt-4 flex flex-wrap items-center gap-2 text-[.94rem]">
      <span class="text-[var(--nh-ink-dim)]">Não achou?</span>
      <a id="whatsBtn" class="btn-x" href="#" target="_blank" rel="noopener">WhatsApp</a>
      <a id="discordBtn" class="btn-x" href="#" target="_blank" rel="noopener">Discord</a>
    </div>
  </div>
</section>

<!-- Histórico -->
<section id="historyPanel" class="hidden mt-3 panel overflow-hidden">
  <div class="p-3 md:p-4 flex items-center justify-between">
    <div class="text-sm text-[var(--nh-ink-dim)]">Últimas 10 perguntas</div>
    <button id="historyClose" class="chip">Fechar</button>
  </div>
  <ul id="historyList" class="divide-y divide-white/10"></ul>
</section>

<footer class="mt-8 md:mt-10 text-xs text-[var(--nh-ink-dim)] flex items-center gap-2 pb-[env(safe-area-inset-bottom)]">
  <span class="kbd">Ctrl/⌘ + K</span> atalho para focar no campo
</footer>

  </main>  <script>
    // ====== Conteúdo base (expansível) ======
    const FAQ = [
      { q:'O que é a NoHeroes?', a:'NoHeroes é o estúdio/lar criativo que inclui o eBook <strong>Manual das Sombras</strong>, projetos autorais e a comunidade.', tags:['sobre','institucional'] },
      { q:'Como comprar o Manual das Sombras?', a:'Na página do eBook, use <strong>Finalizar compra</strong> (botão #btnComprar). O fluxo cria a preferência no Mercado Pago e redireciona ao init_point. Preço <strong>R$ 25</strong> (solo) e <strong>R$ 55</strong> (combo).', tags:['comprar','preço','mercado pago'] },
      { q:'Tem combo do Manual?', a:'Sim, há opção de <strong>combo</strong> (R$ 55) via #addCombo além do preço solo (R$ 25).', tags:['combo','preço'] },
      { q:'Onde vejo o sumário do Manual?', a:'Na seção <strong>Sumário</strong> da página do eBook (mesma página dos botões #ctaComprarTopo e #btnComprar).', tags:['sumário'] },
      { q:'Quais comunidades existem?', a:'Mantemos <strong>WhatsApp</strong> e <strong>Discord</strong>. Convites na Linktree no bloco <em>Comunidades</em>.', tags:['whatsapp','discord','comunidade'] },
      { q:'Onde encontro notícias/updates?', a:'Usamos a página principal e o Discord para avisos. O Oráculo também será atualizado com novidades.', tags:['novidades'] },
      { q:'Posso falar com alguém?', a:'Sim! Use os botões de <strong>WhatsApp</strong> e <strong>Discord</strong> abaixo da resposta.', tags:['suporte','contato'] },
      { q:'Qual o estilo visual da NoHeroes?', a:'Tipografia <strong>Cinzel</strong> para títulos, gradiente dourado-rosa-roxo e fundo em <strong>brasas</strong> (canvas).', tags:['visual','design'] },
      { q:'A IA já está ativa?', a:'Estamos em fase de testes. Esta versão já responde por base de conhecimento local e vai ganhar IA completa em breve.', tags:['ia','testes'] },
      { q:'Funciona no celular?', a:'Sim, layout <strong>mobile-first</strong> com grid responsivo e carrossel de sugestões.', tags:['mobile','responsivo'] },
      { q:'Como reporto um erro?', a:'Fale no <strong>Discord</strong> no canal de suporte ou envie mensagem no WhatsApp.', tags:['erro','bug'] },
      { q:'Tem política de reembolso?', a:'Para compras digitais, siga as instruções de suporte. Avaliamos caso a caso conforme legislação aplicável.', tags:['reembolso'] },
      { q:'Posso presentear o Manual?', a:'Sim, compre normalmente e entre em contato com o suporte para transferência de acesso.', tags:['presente'] },
      { q:'Como receber novidades?', a:'Entre no <strong>Discord</strong> e ative notificações do canal de anúncios.', tags:['notificações'] },
    ];

    const SUGGESTIONS = [
      'Como comprar o Manual das Sombras?',
      'Tem combo do Manual?',
      'Quais são as comunidades?',
      'A IA já está ativa?',
      'Onde vejo o sumário do Manual?'
    ];

    // ====== Helpers ======
    const $ = (s, el=document) => el.querySelector(s);
    const queryIpt = $('#query');
    const askBtn = $('#askBtn');
    const clearBtn = $('#clearBtn');
    const suggestionsEl = $('#suggestions');
    const quickResultsEl = $('#quickResults');
    const answerBox = $('#answerBox');
    const copyBtn = $('#copyBtn');
    const historyToggle = $('#historyToggle');
    const historyPanel = $('#historyPanel');
    const historyClose = $('#historyClose');
    const historyList = $('#historyList');
    const betaModal = $('#betaModal');
    const betaOk = $('#betaOk');

    const whatsBtn = $('#whatsBtn');
    const discordBtn = $('#discordBtn');
    // TODO: trocar pelos links oficiais
    whatsBtn.href = '#';
    discordBtn.href = '#';

    function tokenScore(q, doc){
      const tks = q.toLowerCase().split(' ').filter(Boolean);
      const hay = doc.toLowerCase();
      let s = 0; for(const t of tks){ if(hay.indexOf(t) !== -1) s++; } return s;
    }
    function searchDocs(q){
      if(!q.trim()) return [];
      const arr = FAQ.map(f => ({ f, s: tokenScore(q, f.q + ' ' + f.a + ' ' + (f.tags||[]).join(' ')) }))
        .filter(x => x.s > 0)
        .sort((a,b) => b.s - a.s)
        .slice(0, 6)
        .map(x => x.f);
      return arr;
    }

    function renderSuggestions(){
      suggestionsEl.innerHTML = '';
      SUGGESTIONS.forEach(s => {
        const b = document.createElement('button');
        b.className = 'chip'; b.textContent = s;
        b.onclick = () => { queryIpt.value = s; doAsk(s); };
        suggestionsEl.appendChild(b);
      });
    }

    function renderQuickResults(q){
      const list = searchDocs(q);
      quickResultsEl.innerHTML = '';
      list.forEach(item => {
        const card = document.createElement('button');
        card.className = 'text-left panel p-3 md:p-4 hover:bg-white/10 transition';
        card.innerHTML = '<div class="text-[var(--nh-ink-dim)] text-[12px]">Sugerido</div>'+
                         '<div class="mt-1 font-medium text-[15px] md:text-base">'+item.q+'</div>'+
                         '<div class="mt-1 text-[13px] md:text-sm text-[var(--nh-ink-dim)] line-clamp-2">'+item.a+'</div>';
        card.onclick = () => { queryIpt.value = item.q; doAsk(item.q); };
        quickResultsEl.appendChild(card);
      });
    }

    const HISTORY_KEY = 'oraculo_history_v3';
    function getHistory(){ try{ return JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]'); }catch(e){ return [] } }
    function setHistory(arr){ localStorage.setItem(HISTORY_KEY, JSON.stringify(arr.slice(0,10))); }

    function renderHistory(){
      const items = getHistory();
      historyList.innerHTML = '';
      if(items.length === 0){
        const li = document.createElement('li');
        li.className = 'p-3 md:p-4 text-sm text-[var(--nh-ink-dim)]';
        li.textContent = 'Vazio por enquanto.';
        historyList.appendChild(li);
        return;
      }
      items.forEach(({q,a}) => {
        const li = document.createElement('li');
        li.className = 'p-3 md:p-4';
        const plain = a.replace(/<[^>]+>/g,'');
        li.innerHTML = '<div class="text-sm font-medium">'+q+'</div><div class="text-xs text-[var(--nh-ink-dim)] line-clamp-2">'+plain+'</div>';
        historyList.appendChild(li);
      });
    }

    function setAnswer(html){
      answerBox.innerHTML = html || '<span class="text-[var(--nh-ink-dim)]">Nenhuma pergunta ainda. Experimente uma sugestão acima.</span>';
    }

    function doAsk(qText){
      const q = (qText || queryIpt.value).trim();
      if(!q) return;
      setAnswer('<span class="text-[var(--nh-ink-dim)]">Consultando o Oráculo…</span>');
      setTimeout(() => {
        const hit = searchDocs(q)[0] || FAQ[0];
        const html = '<p><strong>'+hit.q+'</strong></p><p>'+hit.a+'</p>';
        setAnswer(html);
        const hist = getHistory(); hist.unshift({ q, a: html }); setHistory(hist); renderHistory();
      }, 260);
    }

    // Eventos
    askBtn.onclick = () => doAsk();
    queryIpt.addEventListener('input', () => { clearBtn.classList.toggle('hidden', queryIpt.value.trim().length===0); renderQuickResults(queryIpt.value); });
    clearBtn.onclick = () => { queryIpt.value=''; clearBtn.classList.add('hidden'); quickResultsEl.innerHTML=''; setAnswer(''); };
    document.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if((e.ctrlKey||e.metaKey) && k==='k'){ e.preventDefault(); queryIpt.focus(); }
      if(k==='enter' && document.activeElement===queryIpt){ doAsk(); }
      if(k==='escape'){ if(!betaModal.classList.contains('hidden')) closeBeta(); }
    });

    copyBtn.onclick = async () => {
      try{ await navigator.clipboard.writeText((answerBox.textContent||'').trim()); copyBtn.textContent = 'Copiado!'; setTimeout(() => copyBtn.textContent = 'Copiar', 1100); }catch{}
    };

    historyToggle.addEventListener('click', () => { historyPanel.classList.toggle('hidden'); renderHistory(); });
    historyClose.addEventListener('click', () => historyPanel.classList.add('hidden'));

    // Modal beta
    function openBeta(){ betaModal.classList.remove('hidden'); betaModal.classList.add('flex'); }
    function closeBeta(){ betaModal.classList.add('hidden'); betaModal.classList.remove('flex'); }
    betaOk.addEventListener('click', closeBeta);

    // Boot
    (function boot(){ renderSuggestions(); renderQuickResults(''); setAnswer(''); openBeta(); })();

    // Brasas
    (function initBrasas(){
      const c = document.getElementById('brasasCanvas'); if(!c) return; const ctx = c.getContext('2d');
      let w, h; const dpr = window.devicePixelRatio || 1; const N = matchMedia('(min-width: 768px)').matches ? 80 : 48;
      const parts = Array.from({length: N}).map(() => ({ x: Math.random(), y: Math.random(), r: Math.random()*1.6+0.5, v: Math.random()*0.0006+0.00018 }));
      function resize(){ w = c.width = innerWidth*dpr; h = c.height = innerHeight*dpr; }
      addEventListener('resize', resize, { passive:true }); resize();
      function step(){ ctx.clearRect(0,0,w,h); for(const p of parts){ p.y += p.v; if(p.y>1) p.y=0; const x=p.x*w, y=p.y*h; const g=ctx.createRadialGradient(x,y,0,x,y,p.r*16*dpr); g.addColorStop(0,'rgba(255,180,120,.12)'); g.addColorStop(1,'rgba(0,0,0,0)'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,p.r*9*dpr,0,Math.PI*2); ctx.fill(); } requestAnimationFrame(step); }
      if(!matchMedia('(prefers-reduced-motion: reduce)').matches) requestAnimationFrame(step);
    })();
  </script></body>
</html>